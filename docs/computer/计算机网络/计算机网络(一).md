# 计算机网络(一)

## 01-请介绍七层网络体系结构

**参考回答**

1. 为什么分七层

   支持异构网络的互联互通。

2. 七层分别负责的内容（功能）

     OSI 模型把网络通信的工作分为 7 层，从下到上分别是**物理层、数据链路层、网络层、传输层、会话层、表示层和应用层**。

   (1) 物理层

     任务：透明地传输比特流。

     功能：为数据段设备提供传送数据通路

     传输单位：比特

     所实现的硬件：集线器，中继器

   （2）数据链路层

     任务：将网络层传输下来的IP数据报组装成帧

     功能：a. 链路连接的建立、拆除和分离

   ​        b. 帧定界和帧同步

   ​        c.差错检测

     传输单位：帧

     所实现的硬件：交换机、网桥

     协议：PPP,HDLC、SDLC、STP、ARQ

   (3)网络层

     任务：a. 将传输层传下来的报文段封装成分组

   ​        b.选择合适的路由，使得传输层传下来的分组能够交付到目的主机

     功能：a. 为传输层提供服务

   ​        b. 组包和拆包

   ​        c. 路由选择

   ​        d.拥塞控制

     传输单位：数据段

     所实现的硬件：路由器

     协议：ICMP、ARP、RARP、IP、IGMP、OSPF

   (4)传输层

     任务：负责主机中两个进程之间的通信

     功能：

   ​      a. 为端到端连接提供可靠的服务

   ​      b. 为端到端连接提供流量控制、差错控制、服务质量等管理服务

     传输单位：报文段（TCP）或用户数据报（UDP）

     协议：TCP、UDP

   (5)会话层

     任务：不同主机上各进程间的对话

     功能：管理主机间的会话进程，包括建立、管理以及终止进程间的会话。是一种端到端的服务

   (6)表示层

     负责处理在两个内部数据表示结构不同的通信系统之间交换信息的表示格式，为数据加密和解密以及为提高传输效率提供必需的数据压缩以及解压等功能。

   (7)应用层

     任务：提供系统与用户的接口

     功能：

   ​      a.文件传输

   ​      b. 访问和管理

   ​      c. 电子邮件服务

     协议：FTP、SMTP、POP3、HTTP、DNS、TELnet

## 02-请介绍五层网络体系结构

**参考回答**

五层网络体系结构分分别为：**应用层、运输层、网络层、数据链路层、物理层**。各层功能分别如下：

1. 第五层——**应用层**(application layer)

   (1) 应用层(application layer)：是体系结构中的最高。直接为用户的应用进程提供服务。

   (2) 在因特网中的应用层协议很多，如支持万维网应用的HTTP协议，支持电子邮件的SMTP协议，支持文件传送的FTP协议等等。

2. 第四层——**运输层**(transport layer)

   (1) 运输层(transport layer)：负责向两个主机中进程之间的通信提供服务。由于一个主机可同时运行多个进程，因此运输层有**复用**和**分用**的功能。

     a. 复用，就是多个应用层进程可同时使用下面运输层的服务。

     b. 分用，就是把收到的信息分别交付给上面应用层中相应的进程。

   (2) **运输层主要使用以下两种协议：**   **(1) 传输控制协议TCP(Transmission Control Protocol)：**面向连接的，数据传输的单位是报文段，能够提供可靠的交付。   **(2) 用户数据包协议UDP(User Datagram Protocol)：**无连接的，数据传输的单位是用户数据报，不保证提供可靠的交付，只能提供“尽最大努力交付”。

3. 第三层——**网络层**(network layer)

     网络层(network layer)主要包括以下两个任务：

     (1) 负责为分组交换网上的不同主机提供通信服务。在发送数据时，网络层把运输层残生的报文段或用户数据报封装成分组或包进行传送。在TCP/IP体系中，由于网络层使用IP协议，因此分组也叫做IP数据报，或简称为数据报。

     (2) 选中合适的路由，使源主机运输层所传下来的分组，能够通过网络中的路由器找到目的主机。

4. 第二层——**数据链路层**(data link layer)

     **数据链路层(data link layer)：**常简称为链路层，我们知道，两个主机之间的数据传输，总是在一段一段的链路上传送的，也就是说，在两个相邻结点之间传送数据是直接传送的(点对点)，这时就需要使用专门的链路层的协议。

     在两个相邻结点之间传送数据时，数据链路层将网络层交下来的IP数据报组装成帧(framing)，在两个相邻结点之间的链路上“透明”地传送帧中的数据。

     每一帧包括数据和必要的控制信息(如同步信息、地址信息、差错控制等)。典型的帧长是几百字节到一千多字节。

   **注意**：”透明”是一个很重要的术语。它表示，某一个实际存在的事物看起来却好像不存在一样。”在数据链路层透明传送数据”表示无力什么样的比特组合的数据都能够通过这个数据链路层。因此，对所传送的数据来说，这些数据就“看不见”数据链路层。或者说，数据链路层对这些数据来说是透明的。   (1) 在接收数据时，控制信息使接收端能知道一个帧从哪个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可从中提取出数据部分，上交给网络层。   (2) 控制信息还使接收端能检测到所收到的帧中有无差错。如发现有差错，数据链路层就简单地丢弃这个出了差错的帧，以免继续传送下去白白浪费网络资源。如需改正错误，就由运输层的TCP协议来完成。

5. 第一层——**物理层**(physical layer)

   **物理层(physical layer)：**在物理层上所传数据的单位是比特。物理层的任务就是透明地传送比特流。  

## 03-讲一下TCP/IP协议

**参考回答**

1. TCP/IP协议定义

     **TCP/IP**（Transmission Control Protocol/Internet Protocol，传输控制协议/网际协议）是指能够在多个不同网络间实现信息传输的协议簇。TCP/IP协议不仅仅指的是TCP和IP两个协议，而是指一个由FTP、SMTP、TCP、UDP、IP等协议构成的协议簇， 只是因为在TCP/IP协议中TCP协议和IP协议最具代表性，所以被称为TCP/IP协议。

2. TCP/IP协议组成

   TCP/IP结构模型分为**应用层、传输层、网络层、链路层（网络接口层）**四层，以下是各层的详细介绍：

   **（1）应用层**

     应用层是TCP/IP协议的第一层，是直接为应用进程提供服务的。

     a. 对不同种类的应用程序它们会根据自己的需要来使用应用层的不同协议，邮件传输应用使用了SMTP协议、万维网应用使用了HTTP协议、远程登录服务应用使用了有TELNET协议。

     b. 应用层还能加密、解密、格式化数据。

     c. 应用层可以建立或解除与其他节点的联系，这样可以充分节省网络资源。

   **（2）传输层**

     作为TCP/IP协议的第二层，运输层在整个TCP/IP协议中起到了中流砥柱的作用。且在运输层中，TCP和UDP也同样起到了中流砥柱的作用。

   **（3）网络层**

     网络层在TCP/IP协议中的位于第三层。在TCP/IP协议中网络层可以进行网络连接的建立和终止以及IP地址的寻找等功能。

   **（4）链路层（网络接口层）**

     在TCP/IP协议中，网络接口层位于第四层。由于网络接口层兼并了物理层和数据链路层。所以，网络接口层既是传输数据的物理媒介，也可以为网络层提供一条准确无误的线路。

3. TCP/IP协议特点

     TCP/IP协议能够迅速发展起来并成为事实上的标准，是它恰好适应了世界范围内数据通信的需要。它有以下特点：

   （1）协议标准是完全开放的，可以供用户免费使用，并且独立于特定的计算机硬件与操作系统；

   （2）独立于网络硬件系统，可以运行在广域网，更适合于互联网；

   （3）网络地址统一分配，网络中每一设备和终端都具有一个唯一地址；

   （4）高层协议标准化，可以提供多种多样可靠网络服务。

## 04-IP协议包含哪些字段？

**参考答案**

  **IP协议包含字段如下：**

- **4位版本号**：指定IP协议的版本，对于IPv4来说就是4
- **4位头部长度**：IP头部长度有多少个4字节，所以头部最大长度就是15*4=60字节
- **8位服务类型**：3位优先权(已弃用)，4位TOS字段，1位保留字段(必须设置为0)。4为TOS为：最小延时，最大吞吐量，最高可靠性，最小成本，这四个只能选择一个
- **16位总长度**：IP数据报整体占多少字节
- **16为标识**：唯一的标识主机发送的报文，IP报文在数据链路层被分片，那么每一个片中的标识都是相同的
- **3位标志字段**：第一位保留，第二位置1表示进制分片(报文长度超过MTU，丢弃报文)，第三位更多分片，最后一个分片是1，其他是0
- **13位分片偏移**：相对于原始IP报文开始处的偏移
- **8位生存时间**：数据报到达目的地的最大报文跳数，每经过一个路由，TTL-=1，一直到0都没有到达目的地，报文丢弃。
- **8位协议**：表示上层协议类型，把IP交给TCP还是UDP，其中ICMP是1，TCP是6，UDP是17
- **16位头部校验和**：使用CRC校验，鉴别头部是否损坏
- **32位源地址和32位目标地址**：表示发送端和接收端

## 05-介绍一下tcp的三次握手

**参考回答**

1. 第一次握手：建立连接时，客户端发送syn包（syn=x）到服务器，并进入**SYN_SENT**状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。
2. 第二次握手：服务器收到syn包，必须确认客户的SYN（ack=x+1），同时自己也发送一个SYN包（syn=y），即SYN+ACK包，此时服务器进入**SYN_RECV**状态；
3. 第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK(ack=y+1），此包发送完毕，客户端和服务器进入**ESTABLISHED**（TCP连接成功）状态，完成三次握手。

## 06-介绍一下tcp的四次挥手

**参考回答**

1. 客户端进程发出连接释放报文，并且停止发送数据。释放数据报文首部，FIN=1，其序列号为seq=u（等于前面已经传送过来的数据的最后一个字节的序号加1），此时，客户端进入FIN-WAIT-1（终止等待1）状态。 TCP规定，FIN报文段即使不携带数据，也要消耗一个序号。
2. 服务器收到连接释放报文，发出确认报文，ACK=1，ack=u+1，并且带上自己的序列号seq=v，此时，服务端就进入了CLOSE-WAIT（关闭等待）状态。TCP服务器通知高层的应用进程，客户端向服务器的方向就释放了，这时候处于半关闭状态，即客户端已经没有数据要发送了，但是服务器若发送数据，客户端依然要接受。这个状态还要持续一段时间，也就是整个CLOSE-WAIT状态持续的时间。
3. 客户端收到服务器的确认请求后，此时，客户端就进入FIN-WAIT-2（终止等待2）状态，等待服务器发送连接释放报文（在这之前还需要接受服务器发送的最后的数据）。
4. 服务器将最后的数据发送完毕后，就向客户端发送连接释放报文，FIN=1，ack=u+1，由于在半关闭状态，服务器很可能又发送了一些数据，假定此时的序列号为seq=w，此时，服务器就进入了LAST-ACK（最后确认）状态，等待客户端的确认。
5. 客户端收到服务器的连接释放报文后，必须发出确认，ACK=1，ack=w+1，而自己的序列号是seq=u+1，此时，客户端就进入了TIME-WAIT（时间等待）状态。注意此时TCP连接还没有释放，必须经过2∗∗MSL（最长报文段寿命）的时间后，当客户端撤销相应的TCB后，才进入CLOSED状态。
6. 服务器只要收到了客户端发出的确认，立即进入CLOSED状态。同样，撤销TCB后，就结束了这次的TCP连接。可以看到，服务器结束TCP连接的时间要比客户端早一些。

## 07-为什么需要四次挥手？

**参考回答**

1. 四次挥手示意图

   ![img](https://uploadfiles.nowcoder.com/images/20220224/4107856_1645697595713/CEA78F620A6D63E63B355FA2C0373E33)

2. 四次挥手过程

   （1）客户端向服务器发送FIN控制报文段（首部中的 FIN 比特被置位）；

   （2）服务端收到FIN，回复ACK。服务器进入关闭等待状态，发送FIN;

   （3）客户端收到FIN，给服务器回复ACK，客户端进入等待状态（进入“等待”，以确保服务器收到ACK真正关闭连接）;

   （4）服务端收到ACK，链接关闭。

3. **四次挥手原因**

     TCP协议是一种**面向连接的、可靠的、基于字节流的**运输层通信协议。TCP是**全双工模式**，这就意味着，当客户端发出FIN报文段时，只是表示客户端已经没有数据要发送了，客户端告诉服务器，它的数据已经全部发送完毕了；但是，这个时候客户端还是可以接受来自服务端的数据；当服务端返回ACK报文段时，表示它已经知道客户端没有数据发送了，但是服务端还是可以发送数据到客户端的；当服务端也发送了FIN报文段时，这个时候就表示服务端也没有数据要发送了，就会告诉客户端，我也没有数据要发送了，之后彼此就会愉快的中断这次TCP连接。

     简单地说，前 2 次挥手用于关闭一个方向的数据通道，后两次挥手用于关闭另外一个方向的数据通道。

